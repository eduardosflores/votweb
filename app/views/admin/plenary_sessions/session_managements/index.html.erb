<% content_for :angular_controller, 'SessionManagementController' %>
<% content_for :highlight_controller, 'plenary_sessions' %>

<% content_for :sub_header do %>
  <div class="col-sm-6">
    <h2><%= @plenary_session.title %></h2>
    <ol class="breadcrumb">
      <li><%= link_to t('page.modules.home'), [:admin, :root] %></li>
      <li><%= link_to t('page.modules.plenary_sessions'), [:admin, :plenary_sessions] %></li>
      <li class="active">
        <strong><%= t('actions.manage') %></strong>
      </li>
    </ol>
  </div>
  <div class="col-sm-6 text-right">
    <%= link_to [:admin, @plenary_session], class: 'btn btn-w-s btn-white m-t-md m-l-sm' do %>
      <i class="fa fa-reply"></i><br/>
      <%= t('buttons.back') %>
    <% end %>
  </div>
<% end %>

<%= flash_messages %>

<div class="text-right m-b-sm">
  <a href class="btn btn-white" data-toggle="modal" data-target="#plenary-session-details"><i class="fa fa-info"></i></a>
</div>

<div class="row responsive-padding" ng-init="init(<%= @plenary_session.id %>);
                                              pollProcesses = <%= t('enums.specific_items.poll.process').to_json %>;">

  <div class="col-xs-12">
    <div class="tabs-container">
      <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#session-items-list"><%= t('miscellaneous.session_item.list') %></a></li>
        <li><a data-toggle="tab" href="#polls"><%= t('activerecord.attributes.plenary_session.polls') %></a></li>
        <li><a data-toggle="tab" href="#queues"><%= t('activerecord.attributes.plenary_session.queues') %></a></li>
        <li><a data-toggle="tab" href="#members"><%= t('activerecord.attributes.plenary_session.members') %></a></li>
      </ul>
      <div class="tab-content">
        <div id="session-items-list" class="tab-pane active">
          <div class="panel-body">
<!-- Itens da ordem do dia da sessão, com opções para: -->
<!--  - iniciar votação para o item -->
<!--  - marcar como aprovado, rejeitado ou não votado -->

            <%= custom_flash_messages info: {show: true, fixed: true, icon: :info, message: t('info.no_results')}, html: {'ng-hide' => 'loading || plenarySession.items.length > 0'} %>

            <div ng-show="loading || plenarySession.items.length > 0">
              <div class="m-t-md">
                <small class="pull-right text-muted" ng-bind-html="'info.records_added_html' | t:{count: plenarySession.items.length || 0} | trust"></small><br>
                <hr class="m-t-none">
              </div>

              <div class="table-responsive">
                <div loading-container="loading">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th><%= t('activerecord.attributes.session_item.title') %></th>
                        <th><%= t('activerecord.attributes.session_item.author') %></th>
                        <th><%= t('activerecord.attributes.session_item.acceptance') %></th>
                      </tr>
                    </thead>

                    <tbody>
                      <tr ng-repeat="item in plenarySession.items track by item.id" ng-class="{'success': item.acceptance === 'approved', 'danger': item.acceptance === 'rejected'}">
                        <td>{{$index + 1}}. {{item.title}}</td>
                        <td>{{item.author.name}}</td>
                        <td>
                          <i class="fa" ng-class="{
                              'fa-check text-navy': item.acceptance === 'approved',
                              'fa-times text-warning': item.acceptance === 'rejected',
                              'fa-ellipsis-h text-muted': item.acceptance === 'not_voted'
                            }"></i>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="polls" class="tab-pane">
          <div class="panel-body">
            <div class="row m-b-md">
              <div class="col-xs-12 text-right">
                <%= link_to '', class: 'btn btn-w-s btn-primary', 'data-toggle' => 'modal', 'data-target' => '#add-poll' do %>
                  <i class="fa fa-plus"></i><br/>
                  <%= t('buttons.new') %>
                <% end %>
              </div>
            </div>

            <%= custom_flash_messages info: {show: true, fixed: true, icon: :info, message: t('info.no_results')}, html: {'ng-hide' => 'loading || plenarySession.polls.length > 0'} %>

            <div ng-show="loading || plenarySession.polls.length > 0">
              <div class="m-t-md">
                <small class="pull-right text-muted" ng-bind-html="'info.records_added_html' | t:{count: plenarySession.polls.length || 0} | trust"></small><br>
                <hr class="m-t-none">
              </div>

              <div class="table-responsive">
                <div loading-container="loading">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th><%= t('activerecord.attributes.poll.description') %></th>
                        <th><%= t('activerecord.attributes.poll.process') %></th>
                        <th><%= t('activerecord.attributes.poll.duration') %></th>
                        <th><%= t('activerecord.attributes.poll.created_at') %></th>
                      </tr>
                    </thead>

                    <tbody>
                      <tr ng-repeat="poll in (plenarySession.polls | orderBy:'-created_at') track by poll.id">
                        <td>{{poll.description | truncate:60}}</td>
                        <td>{{pollProcesses[poll.process]}}</td>
                        <td>{{ 'info.seconds' | t:{count: poll.duration || 0} }}</td>
                        <td>{{poll.created_at | date:'medium'}}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="queues" class="tab-pane">
          <div class="panel-body">
            <div class="row m-b-md">
              <div class="col-xs-12 text-right">
                <%= link_to '', class: 'btn btn-w-s btn-primary', 'data-toggle' => 'modal', 'data-target' => '#add-queue' do %>
                  <i class="fa fa-plus"></i><br/>
                  <%= t('buttons.new') %>
                <% end %>
              </div>
            </div>

            <%= custom_flash_messages info: {show: true, fixed: true, icon: :info, message: t('info.no_results')}, html: {'ng-hide' => 'loading || plenarySession.queues.length > 0'} %>

            <div ng-show="loading || plenarySession.queues.length > 0">
              <div class="m-t-md">
                <small class="pull-right text-muted" ng-bind-html="'info.records_added_html' | t:{count: plenarySession.queues.length || 0} | trust"></small><br>
                <hr class="m-t-none">
              </div>

              <div class="table-responsive">
                <div loading-container="loading">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th><%= t('activerecord.attributes.queue.created_at') %></th>
                      </tr>
                    </thead>

                    <tbody>
                      <tr ng-repeat="queue in (plenarySession.queues | orderBy:'-created_at') track by queue.id">
                        <td>{{queue.created_at | date:'medium'}}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="members" class="tab-pane">
          <div class="panel-body">
<!-- Lista de todos os vereadores na sessão em ordem alfabética, com marcação se é presidente e se está presente, e botão para iniciar chamada de presença -->

            <%= custom_flash_messages info: {show: true, fixed: true, icon: :info, message: t('info.no_results')}, html: {'ng-hide' => 'loading || plenarySession.members.length > 0'} %>

            <div ng-show="loading || plenarySession.members.length > 0">
              <div class="m-t-md">
                <small class="pull-right text-muted" ng-bind-html="'info.records_added_html' | t:{count: plenarySession.members.length || 0} | trust"></small><br>
                <hr class="m-t-none">
              </div>

              <div class="table-responsive">
                <div loading-container="loading">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th><%= t('activerecord.attributes.councillor.name') %></th>
                        <th><%= t('activerecord.attributes.councillor.party_id') %></th>
                        <th><%= t('activerecord.attributes.session_member.is_president') %></th>
                        <th><%= t('activerecord.attributes.session_member.is_present') %></th>
                      </tr>
                    </thead>

                    <tbody>
                      <tr ng-repeat="member in plenarySession.members track by member.id" ng-class="{'warning': member.is_present === false}">
                        <td>{{$index + 1}}. {{member.councillor.name}}</td>
                        <td>{{member.councillor.party.abbreviation}}</td>
                        <td><i class="fa {{member.is_president ? 'fa-check text-navy' : 'fa-times text-muted'}}"></i></td>
                        <td>
                          <i class="fa" ng-class="{
                            'fa-check text-navy': member.is_present,
                            'fa-times text-warning': member.is_present === false,
                            'fa-ellipsis-h text-muted': member.is_present === null
                          }"></i>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal inmodal" id="plenary-session-details" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content animated fadeIn">
      <div class="modal-header">
        <i class="fa fa-bullhorn modal-icon"></i>
        <h4 class="modal-title"><%= t('activerecord.models.plenary_session.one') %></h4>
      </div>
      <div class="modal-body">
        <%= render partial: 'admin/plenary_sessions/details', locals: { plenary_session: @plenary_session } %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-white" data-dismiss="modal"><%= t('buttons.close') %></button>
      </div>
    </div>
  </div>
</div>

<div class="modal inmodal" id="add-poll" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content animated fadeIn">
      <div class="modal-header">
        <i class="fa fa-ticket modal-icon"></i>
        <h4 class="modal-title"><%= t('miscellaneous.poll.add') %></h4>
      </div>
      <div class="modal-body">

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-white" data-dismiss="modal"><%= t('buttons.close') %></button>
        <button type="button" class="btn btn-primary"><%= t('buttons.add') %></button>
      </div>
    </div>
  </div>
</div>

<div class="modal inmodal" id="add-queue" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content animated fadeIn">
      <div class="modal-header">
        <i class="fa fa-group modal-icon"></i>
        <h4 class="modal-title"><%= t('miscellaneous.queue.add') %></h4>
      </div>
      <div class="modal-body">

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-white" data-dismiss="modal"><%= t('buttons.close') %></button>
        <button type="button" class="btn btn-primary"><%= t('buttons.add') %></button>
      </div>
    </div>
  </div>
</div>
